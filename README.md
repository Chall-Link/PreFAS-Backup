=================================================  

# Chall-Link「PreFAS Backup」『プリファス バックアップ』 - Precious Files Archive Script 
## 日本語版 Ver.1.0.0 
## VSS対応・貴重ファイル暗号化アーカイブスクリプト

`災害から貴重なファイルを守るため、大容量ドライブや大容量フォルダを7-ZipのAES-256暗号化で可搬性のあるアーカイブに変換し、クラウドやM-Disc（100年耐久光ディスク）に保存することをコンセプトに開発されたツールです`

**【著作権者】** Chall-Link（シャルリンク）  
**【開発地】** Developed in Japan  
**【種別】** フリーソフトウェア  

=================================================
> 💡 「アーカイブ」≒「圧縮」or「圧縮ファイル」
> 💡 「スナップショット」≒「シャドーコピー」

&emsp; 

## ■概要：画期的な特徴

### 概要
テラバイトレベルの長期的に安全に保存したいドライブやフォルダを7-ZipによりAES256で強力に暗号化して圧縮ファイルにするスクリプト。
同梱のChall-Link「VSSDetector」により、WindowsのVSS 復元ポイント＝スナップショットを活用したバックアップが可能。それにより、バックアップ処理中でも元フォルダで作業を継続できます。

### このスクリプトで解決できる事
家庭や事務所のPCやハードディスクには、紛失すると買い直しがきかない多くの大切なファイルがあります。想い出の写真、プログラムファイル、設計図、アイデアノートなど…  
一方、地震などの災害に対する意識が高まる昨今、大切なファイルを一カ所にだけオリジナルファイルを保存する事は、大切なファイル資産の長期安全な保管の観点からは全くの無防備と言わざるを得ません。

そこで考案されたのが、大切なファイルが含まれるテラバイトレベルの大容量のドライブや大容量のフォルダを、7-Zipで光ディスクに保存可能な25GBに分割したAES-256暗号化ファイルにし、光ディスクに保存して遠隔地に保存したり、クラウドにアップロード保存し、バックアップを長期安全に保管するリスク回避策です。
パスワードだけ自分で保管しておけば、遠隔地に保存しながらファイルの内容も見られることはなく、災害のファイル紛失リスクも最小限に抑える事が可能となります。

`これが、Chall-Link「PreFAS Backup」『プリファス バックアップ』の制作コンセプトです。`  
PreFAS Backupは、このための回避策を最適化した、7-Zip機能拡張スクリプトです。

PreFAS Backupの、PreFASは、「**Pre** cious **F**iles **A**rchive **S**cript」  
すなわち、「貴重ファイルのアーカイブスクリプト」から命名されています。

### 一般的なバックアップソフトとの違い
- 多くの市販ソフトはバージョンアップの影響で、今のバージョンで作成したバックアップを、例えば5年後のバージョンで復元可能は不明確です。ソフトウェア自体が無くなっている可能性もあります。よって、長期バックアップの観点からは、PreFAS Backupのように、より汎用性の高いフォーマットでの保存が合理的です。
- 市販ソフトは、ソフトウェアの構造が複雑なためにPC環境との相性で動作が不安定になる場合があります。PreFAS Backupはシンプルな構成なので、プラットフォームに対する安定性は高く設計されています。
- 有名市販バックアップソフトの中には、バックアップファイルをソフトの管理機能から切り離せない物もあります。そういう物は、バックアップファイル単体で、光ディスクに保存したり、クラウドにコピーしたり、ユーザーが自由に扱う事が禁止されている場合があります。PreFAS Backupはバックアップファイルは7-Zipなので、通常の単独ファイルとして自由に扱う事が可能です。

### ■PreFAS Backupの特徴
- 独立したアーカイブ：作成されたバックアップファイルはエクスプローラーで自由にコピー・移動可能  
- 大規模対応：テラバイト級のフォルダ/ドライブを全自動でバックアップ  
- VSS対応：姉妹ソフトChall-Link「VSSDetector」と併用し、Windows復元ポイントのスナップショットを利用して、バックアップ中も元フォルダでの作業を継続可能。
- 負荷低減による処理中の快適なPC作業環境：7-ZipのCPU負荷を制御しバックアップ中でも、ソースフォルダでの編集作業を快適に  
- セキュアなアーカイブ：AES-256暗号化でデータを強力に保護
- 光ディスク最適化：25GB、50GB、100GBの光ディスクへの保存を想定した効率的な分割サイズのデフォルト設定  
- カスタマイズ性：スクリプトに設定を直接記述し、繰り返し利用可能なカスタムバックアップを実現  
- プロ品質の信頼性：市販ソフト並みのエラーハンドリングシステム
- 高度な制御：7-ZipのGUIでは利用できない詳細な制御パラメータを活用可能  

&nbsp;

## ■動作環境

- **必須ソフト**: 7-Zip（LGPLライセンス）が必要（[https://www.7-zip.org/](https://www.7-zip.org/) から入手）  
- **文字コード・改行コード**: 本スクリプトは日本語対応のWindowsスクリプトで、Shift-JISエンコーディングとCRLF改行コードでなければ正常に動作しません。  
  [GitHub Release](https://github.com/Chall-Link/PreFAS-Backup/releases) 掲載の「Source code (zip)」をダウンロードすると適切な形でダウンロードできますが、一方で GitHubのRawダウンロードでダウンロードすると改行コードがLFになり動作しませんのでご注意ください。  
- **Windows 10 Pro 64bit**: （動作確認済み）、理論上はWindows 7 SP1以上で動作可能（未確認のため自己責任でテスト推奨）  
- **必要条件**: PowerShell 2.0以上（Windows標準搭載）、管理者権限  
- **VSSスナップショットをアーカイブソースにする場合**: Chall-Link「VSSDetector」（ [VSSDetector-GitHub Release](https://github.com/Chall-Link/VSSDetector/releases)から入手）

&emsp; 

### ■スクリプト利用時に「WindowsによってPCが保護されました」が出た場合
初回利用時にWindows Defender SmartScreenが警告を表示する場合があります。これは署名されていない新しいソフトウェアに対する標準的な警告です。

**安全性について：**
- ESETウイルススキャン（ローカル確認済み）
- 完全オープンソース（内容確認可能）

**実行方法：** 警告画面で「詳細情報」→「実行」をクリック

## 構成
- ChaL-PreFAS-Backup-MAIN.bat
- ChaL-PreFAS-Backup-SUB.bat

PreFAS-Sub.bat を開き、変数にアーカイブソースのパス、出力先フォルダのパスなどを設定し、
PreFAS-Main.batを管理者権限で実行すると、自動的にPreFAS-Sub.batが実行されます。MainからSubを実行する事で、7-ZipによりCPUが過負荷にならないようWindows上でのスクリプトの処理優先度を制御しています。

---

## 使用前に必ずお読み下さい

- 全ての対象ファイルをバックアップできるように PreFAS-Main.batの実行は管理者権限を必要としています。
- ２つのファイルは必ず同じフォルダ内に配置して下さい。
- 本スクリプトでCPUに過負荷がかからないように制御していますが、本スクリプトは長時間の実行を想定しているのでPCファンが通常より高速回転する音がしたりCPUに過負荷がかかっている様子がありましたら、本スクリプト使用を中止を検討して下さい。
- 圧縮ファイル名、対象フォルダ、出力フォルダなど、全て英数半角のみ使用してください。

---

## VSS機能の活用シーン

- **クリエイター**: 4TBの作品フォルダをバックアップしながら、新しい作品制作を継続
- **開発者**: プロジェクト全体をバックアップしながら、コーディング作業を継続
- **動画編集者**: 大容量プロジェクトをバックアップしながら、編集作業を継続
- **フォトグラファー**: RAW画像アーカイブをバックアップしながら、新しい撮影・編集を継続
- **小規模事業者**: 業務データをバックアップしながら、日常業務を継続

> **⚠️ 注意**: VSS機能はデータドライブ（D:、E:等）で利用可能。システムドライブ（C:）は対象外

---

## 背景となる課題

プライベートな写真、設計図・デザイン、アイデアなど、家庭や事務所のPCだけで保存している貴重なファイルは、不意の災害（地震、津波、火災、落雷、盗難など）によって一瞬で失われるリスクがあります。

---

## 課題解決のための方針

現時点の貴重ファイルをバックアップし、家庭や事務所から離れた別の場所に分散保存しておけば、災害によるファイルの消失リスクを低減する事ができます。そこで、例えば下記のバックアップの保管方法を想定します。

- クラウドストレージへのバックアップ保存
- 100年耐久性を謳う「M-Disc」への保存

> **⚠️ 注意**: 一般的なDVD・Blu-rayの寿命は最大20年程度とされます。

---

## セキュリティ上の課題

外部に貴重なファイルを保管する場合、新たに次のようなセキュリティリスクが発生します。

- クラウドハッキングによる情報漏洩
- M-Discの物理的な盗難

---

## 上記課題を解決する本スクリプトの説明

本スクリプトはパスワード入力により任意のフォルダを、7-ZipでAES-256による強力な暗号化圧縮（アーカイブ）ファイルにすることができます。そして、それらのファイルを、クラウドやM-Discに外部保管する事で、現時点の貴重ファイル群の、消失と、情報漏洩の両方のリスクに対し強力に防御する事を実現しています。

また、デフォルト設定で圧縮ファイルを24,337,262kbで分割するようになっていますが、この値は100GBのM-Disc, Blu-ray Discなどに4ファイル納め、約370MBの余裕ができ、その部分にアーカイブの説明ファイルなどを保管できるようになっています。このように本スクリプトは外部保存を想定した最適化がなされています。

---

## 情報漏洩リスク

パスワードは英数字や記号を含むランダムな20〜30桁以上を推奨しています。このようなパスワードは、現代のスーパーコンピュータや量子コンピュータを用いても、実質的に解析は不可能であるとされています。よって、パスワードさえ厳重に保管できれば、現代の技術では万一ファイルのみが外部に流出しても解読リスクはほぼゼロになるようになっています。

---

## カスタマイズ性

7-Zip作業を、スクリプト化する事で、自分だけの定番の7zipアーカイブ処理をいつでも実行出来るようになります。また、スクリプト内のコメントとして、独自のメモを追記していくことも可能です。

---

## 長時間処理の注意

数TB以上の処理になると、1日を越える長時間の処理となる場合があります。その場合、CPUに強い負荷がかかり続けないようにコントロールする事も重要になってきますが、本スクリプトではCPUの負荷が過剰にならないような対策も実現しています。

---

## 使い方

### 通常のバックアップの場合

1. PreFAS-Sub.batを開いて、【設定必須】変数グループＡの変数を確認・編集して下さい。編集方法の説明は、PreFAS-Sub.bat内に解説があります。

   **【設定必須】変数グループＡ**:
   - (A-1) 7-Zipインストールパスの設定
   - (A-2) アーカイブファイル名
   - (A-3) アーカイブする対象ソースフォルダ
   - (A-4) 7zipアーカイブ出力フォルダ
   - (A-5) 除外ファイル、除外フォルダ

2. 必要に応じて下記変数グループを修正します。
   - 【確認と必要に応じて修正】変数グループＢ
   - 【状況に応じて修正】変数グループＣ

3. PreFAS-Main.batを右クリックして、「管理者として実行」からスクリプトを実行します。

4. 圧縮ファイルに設定するパスワードを2回入力します。

5. 圧縮が終了するまでお待ちください。コマンドウィンドウを間違って閉じないよう、ウィンドウ背景を水色にしています。

### VSS機能を使用する場合（バックアップ中も作業継続可能）

1. ChaL-VSSDetectorフォルダ内の「ChaL-VSSDetector.bat」を管理者権限で実行

2. 表示されるスナップショット一覧から、使用したいものを選択。結果は「ChaL-RESULT-VSSDetector.txt」に保存されます

3. 表示されたVSSパス（例: `\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\*`）をPreFAS-Sub.batの「アーカイブする対象ソースフォルダ」に設定

4. 上記「通常のバックアップ」の手順(3)以降を実行

**👉 これで、バックアップ処理中でも元のファイル・フォルダで作業を続けることができます！**

---

## エラー発生時の対処

- 背景色が水色から黄色に変わったり「Everything is Ok」が表示されないなど、エラーが発生した場合、出力フォルダ内のエラーログ「Results_PreFAS_ERROR_*.log」を確認してください。
- 7-Zipが未インストールの場合は、[https://www.7-zip.org/](https://www.7-zip.org/)から7-Zipを入手しインストールし、PreFAS-Sub.batの【設定必須】変数グループＡの(A-1)の内容を見直して下さい。
- フォルダ設定に問題があった場合は、PreFAS-Sub.batの【設定必須】変数グループＡの(A-3)(A-4)の設定を見直して下さい。

---

## 著作権・免責事項

本ソフトウェアはフリーソフトウェア（MITライセンス）です。著作権はChall-Linkに帰属します。本ツールは7-Zip（LGPLライセンス）を使用します。7-Zipの詳細については[https://www.7-zip.org/](https://www.7-zip.org/)をご参照ください。

本スクリプトの使用による損害や障害について、著作者は一切の責任を負いません。スクリプトのコアロジックを保持する場合、通信や個人的な手渡しによる転載・配布は自由ですが、出典として「Chall-Link」を明記してください。悪意ある使用や改変は禁止です。

ご意見・ご感想はGitHubリポジトリのIssues（[https://github.com/Chall-Link/PreFAS](https://github.com/Chall-Link/PreFAS)）にてお願いします。個別サポートや返信は行っておりません。

---

## タグ

- バックアップ
- 災害対策
- データ保護
- 暗号化
- 7zip
- アーカイブ
- ファイルセキュリティ
- クラウド保存
- M-Disc
- VSS
- Volume Shadow Copy

[Tags: backup, disaster-recovery, data-protection, encryption, 7zip, archive, secure-backup, VSS, volume-shadow-copy]
